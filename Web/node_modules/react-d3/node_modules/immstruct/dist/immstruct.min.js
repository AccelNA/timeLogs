/**
* immstruct v1.4.0
* Authors: Mikael Brevik, @torgeir
***************************************/
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.immstruct=t()}}(function(){return function t(e,n,r){function i(s,u){if(!n[s]){if(!e[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[s]={exports:{}};e[s][0].call(f.exports,function(t){var n=e[s][1][t];return i(n?n:t)},f,f.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e){function n(){return this instanceof n?void(this.instances={}):new n}function r(t,e){if("object"==typeof e.key&&(e.data=e.key,e.key=void 0),e.key&&t.instances[e.key])return t.instances[e.key];var n=new i(e);return t.instances[n.key]=n,n}var i=t("./src/structure");n.prototype.get=function(t,e){return r(this,{key:t,data:e})},n.prototype.clear=function(){this.instances={}},n.prototype.remove=function(t){return delete this.instances[t]},n.prototype.withHistory=function(t,e){return r(this,{key:t,data:e,history:!0})};var o=new n;e.exports=function(t,e){return r(o,{key:t,data:e})},e.exports.withHistory=function(t,e){return r(o,{key:t,data:e,history:!0})},e.exports.Structure=i,e.exports.Immstruct=n,e.exports.clear=o.clear.bind(o),e.exports.remove=o.remove.bind(o),Object.defineProperty(e.exports,"instances",{get:function(){return o.instances},enumerable:!0,configurable:!0})},{"./src/structure":5}],2:[function(t,e){"use strict";function n(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function r(){}r.prototype._events=void 0,r.prototype.listeners=function(t){if(!this._events||!this._events[t])return[];if(this._events[t].fn)return[this._events[t].fn];for(var e=0,n=this._events[t].length,r=new Array(n);n>e;e++)r[e]=this._events[t][e].fn;return r},r.prototype.emit=function(t,e,n,r,i,o){if(!this._events||!this._events[t])return!1;var s,u,a=this._events[t],c=arguments.length;if("function"==typeof a.fn){switch(a.once&&this.removeListener(t,a.fn,!0),c){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,e),!0;case 3:return a.fn.call(a.context,e,n),!0;case 4:return a.fn.call(a.context,e,n,r),!0;case 5:return a.fn.call(a.context,e,n,r,i),!0;case 6:return a.fn.call(a.context,e,n,r,i,o),!0}for(u=1,s=new Array(c-1);c>u;u++)s[u-1]=arguments[u];a.fn.apply(a.context,s)}else{var f,h=a.length;for(u=0;h>u;u++)switch(a[u].once&&this.removeListener(t,a[u].fn,!0),c){case 1:a[u].fn.call(a[u].context);break;case 2:a[u].fn.call(a[u].context,e);break;case 3:a[u].fn.call(a[u].context,e,n);break;default:if(!s)for(f=1,s=new Array(c-1);c>f;f++)s[f-1]=arguments[f];a[u].fn.apply(a[u].context,s)}}return!0},r.prototype.on=function(t,e,r){var i=new n(e,r||this);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],i]:this._events[t].push(i):this._events[t]=i,this},r.prototype.once=function(t,e,r){var i=new n(e,r||this,!0);return this._events||(this._events={}),this._events[t]?this._events[t].fn?this._events[t]=[this._events[t],i]:this._events[t].push(i):this._events[t]=i,this},r.prototype.removeListener=function(t,e,n){if(!this._events||!this._events[t])return this;var r=this._events[t],i=[];if(e&&(r.fn&&(r.fn!==e||n&&!r.once)&&i.push(r),!r.fn))for(var o=0,s=r.length;s>o;o++)(r[o].fn!==e||n&&!r[o].once)&&i.push(r[o]);return i.length?this._events[t]=1===i.length?i[0]:i:delete this._events[t],this},r.prototype.removeAllListeners=function(t){return this._events?(t?delete this._events[t]:this._events={},this):this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prototype.setMaxListeners=function(){return this},r.EventEmitter=r,r.EventEmitter2=r,r.EventEmitter3=r,e.exports=r},{}],3:[function(t,e,n){function r(t,e,n){return 1===arguments.length?e=[]:"function"==typeof e?(n=e,e=[]):e=p(e),s(t,e,n)}function i(t,e,n,r){this.size=r,this._rootData=t,this._keyPath=e,this._onChange=n}function o(t,e,n,r){this.size=r,this._rootData=t,this._keyPath=e,this._onChange=n}function s(t,e,n,r){arguments.length<4&&(r=t.getIn(e));var s=r&&r.size,u=l.isIndexed(r)?o:i;return new u(t,e,n,s)}function u(t,e,n){return l.isIterable(n)?a(t,e,n):n}function a(t,e,n){return s(t._rootData,f(t._keyPath,e),t._onChange,n)}function c(t,e,n){var r=arguments.length>2,i=t._rootData.updateIn(t._keyPath,r?_():void 0,e),o=t._keyPath||[],u=t._onChange&&t._onChange.call(void 0,i,t._rootData,r?f(o,n):o);return void 0!==u&&(i=u),s(i,t._keyPath,t._onChange)}function f(t,e){return t.concat(h(e))}function h(t){return Array.isArray(t)?t:v.Iterable(t).toArray()}function p(t){return Array.isArray(t)?t:l.isIterable(t)?t.toArray():[t]}var v="undefined"!=typeof window?window.Immutable:"undefined"!=typeof global?global.Immutable:null,l=v.Iterable,d=l.Iterator,y=v.Seq,_=v.Map,m=Object.create(y.Keyed.prototype),g=Object.create(y.Indexed.prototype);m.constructor=i,g.constructor=o,m.toString=function(){return this.__toString("Cursor {","}")},g.toString=function(){return this.__toString("Cursor [","]")},m.deref=m.valueOf=g.deref=g.valueOf=function(t){return this._rootData.getIn(this._keyPath,t)},m.get=g.get=function(t,e){return this.getIn([t],e)},m.getIn=g.getIn=function(t,e){if(t=h(t),0===t.length)return this;var n=this._rootData.getIn(f(this._keyPath,t),I);return n===I?e:u(this,t,n)},g.set=m.set=function(t,e){return c(this,function(n){return n.set(t,e)},[t])},g.setIn=m.setIn=_.prototype.setIn,m.remove=m["delete"]=g.remove=g["delete"]=function(t){return c(this,function(e){return e.remove(t)},[t])},g.removeIn=g.deleteIn=m.removeIn=m.deleteIn=_.prototype.deleteIn,m.clear=g.clear=function(){return c(this,function(t){return t.clear()})},g.update=m.update=function(t,e,n){return 1===arguments.length?c(this,t):this.updateIn([t],e,n)},g.updateIn=m.updateIn=function(t,e,n){return c(this,function(r){return r.updateIn(t,e,n)},t)},g.merge=m.merge=function(){var t=arguments;return c(this,function(e){return e.merge.apply(e,t)})},g.mergeWith=m.mergeWith=function(){var t=arguments;return c(this,function(e){return e.mergeWith.apply(e,t)})},g.mergeIn=m.mergeIn=_.prototype.mergeIn,g.mergeDeep=m.mergeDeep=function(){var t=arguments;return c(this,function(e){return e.mergeDeep.apply(e,t)})},g.mergeDeepWith=m.mergeDeepWith=function(){var t=arguments;return c(this,function(e){return e.mergeDeepWith.apply(e,t)})},g.mergeDeepIn=m.mergeDeepIn=_.prototype.mergeDeepIn,m.withMutations=g.withMutations=function(t){return c(this,function(e){return(e||_()).withMutations(t)})},m.cursor=g.cursor=function(t){return t=p(t),0===t.length?this:a(this,t)},m.__iterate=g.__iterate=function(t,e){var n=this,r=n.deref();return r&&r.__iterate?r.__iterate(function(e,r){return t(u(n,[r],e),r,n)},e):0},m.__iterator=g.__iterator=function(t,e){var n=this.deref(),r=this,i=n&&n.__iterator&&n.__iterator(d.ENTRIES,e);return new d(function(){if(!i)return{value:void 0,done:!0};var e=i.next();if(e.done)return e;var n=e.value,o=n[0],s=u(r,[o],n[1]);return{value:t===d.KEYS?o:t===d.VALUES?s:[o,s],done:!1}})},i.prototype=m,o.prototype=g;var I={};n.from=r},{immutable:void 0}],4:[function(t,e){e.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],5:[function(t,e){(function(n){function r(t){var e=this;return t=t||{},this instanceof r?(this.key=t.key||I.generateRandomKey(),this.current=t.data,l(this.current)&&this.current||(this.current=y.fromJS(this.current||{})),t.history&&(this.history=y.List.of(this.current),this._currentRevision=0),this._pathListeners=[],this.on("swap",function(t,n,r){h(e._pathListeners,f(r)).forEach(function(e){e.forEach(function(e){"function"==typeof e&&e(t,n,r)})})}),void m.call(this,arguments)):new r(t)}function i(t,e){return function(n,r){var i=e.apply(e,arguments);return t.history&&n!==r?(t.history=t.history.take(++t._currentRevision).push(t.current),i):i}}function o(t,e){return function(n,r,i){var o=e.apply(e,arguments);return n===r?o:(t.emit("swap",o,r,i),w(t,o,r,i),o)}}function s(t,e){return function(n,r,i){var o=e.apply(e,arguments);if(n===r)return o;var s=a(n,r,i);return s.eventName&&t.emit.apply(t,[s.eventName].concat(s.arguments)),o}}function u(t,e,n,r){n&&n.forEach(function(n){if(!r||n!==r){var i=t._pathListeners[e].indexOf(n);t._pathListeners[e].splice(i,1)}})}function a(t,e,n){var r,i,o=e&&e.getIn(n),s=t&&t.getIn(n),u=e&&c(e,n),a=t&&c(t,n);return u&&!a?(i="delete",r=[n,o]):u&&a?(i="change",r=[n,s,o]):!u&&a&&(i="add",r=[n,s]),{eventName:i,arguments:r}}function c(t,e){return t.hasIn?t.hasIn(e):t.getIn(e,b)!==b}function f(t){var e="global";return t&&t.length?[e].concat(t).join("|"):e}function h(t,e){var n=[];for(var r in t){if(!t.hasOwnProperty(r))return;0===e.indexOf(r)&&n.push(t[r])}return n}function p(t,e){return function(n,r,i){var o=a(n,r,i);if(o.eventName===t)return e(n,r,i)}}function v(t){return t&&"function"==typeof t.deref}function l(t){return d("Iterable","isIterable",t)||d("Seq","isSeq",t)||d("Map","isMap",t)||d("OrderedMap","isOrderedMap",t)||d("List","isList",t)||d("Stack","isStack",t)||d("Set","isSet",t)}function d(t,e,n){return y[t]&&y[t][e]&&y[t][e](n)}var y="undefined"!=typeof window?window.Immutable:"undefined"!=typeof n?n.Immutable:null,_=t("immutable/contrib/cursor"),m=t("eventemitter3").EventEmitter,g=t("inherits"),I=t("./utils");g(r,m),e.exports=r,r.prototype.cursor=function(t){var e=this;if(t=t||[],!this.current)throw new Error("No structure loaded.");var n=function(t,n,r){return e.current=e.current===n?t:c(t,r)?e.current.setIn(r,t.getIn(r)):e.current.removeIn(r)};return n=i(this,n),n=o(this,n),n=s(this,n),_.from(e.current,t,n)},r.prototype.reference=function(t){v(t)&&t._keyPath&&(t=t._keyPath);var e=this,n=f(t),r=e._pathListeners[n],i=this.cursor(t),o=function(){i=e.cursor(t)},s=[o];return this._pathListeners[n]=r?r.concat(o):s,{observe:function(t,r){return"function"==typeof t&&(r=t,t=void 0),this._dead||"function"!=typeof r?void 0:(t&&"swap"!==t&&(r=p(t,r)),e._pathListeners[n]=e._pathListeners[n].concat(r),s=s.concat(r),function(){var t=e._pathListeners[n].indexOf(r),i=s.indexOf(r);s[i]===r&&s.splice(i,1),e._pathListeners[n]&&e._pathListeners[n][t]===r&&e._pathListeners[n].splice(t,1)})},cursor:function(t){return t?i.cursor(t):i},unobserveAll:function(){u(e,n,s,o),s=[o]},destroy:function(){u(e,n,s),s=void 0,i=void 0,this._dead=!0,this.observe=void 0,this.unobserveAll=void 0,this.cursor=void 0,this.destroy=void 0}}},r.prototype.forceHasSwapped=function(t,e,n){this.emit("swap",t||this.current,e,n),w(this,t||this.current,e,n)},r.prototype.undo=function(t){return this._currentRevision-=t||1,this._currentRevision<0&&(this._currentRevision=0),this.current=this.history.get(this._currentRevision),this.current},r.prototype.redo=function(t){return this._currentRevision+=t||1,this._currentRevision>this.history.count()-1&&(this._currentRevision=this.history.count()-1),this.current=this.history.get(this._currentRevision),this.current},r.prototype.undoUntil=function(t){return this._currentRevision=this.history.indexOf(t),this.current=t,t};var w=function(){var t=!1;return"function"!=typeof requestAnimationFrame?function(){}:function(e,n,r){t||(t=!0,requestAnimationFrame(function(){t=!1,e.emit("next-animation-frame",n,r)}))}}(),b={}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./utils":6,eventemitter3:2,"immutable/contrib/cursor":3,inherits:4}],6:[function(t,e){e.exports.generateRandomKey=function(t){return t=t||10,Math.random().toString(36).substring(2).substring(0,t)}},{}]},{},[1])(1)});